<html lang="zh-CN"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>嫡系计算器2.0</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#10b981',
            accent: '#8b5cf6',
            neutral: '#1f2937',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .btn-primary {@apply bg-primary text-white font-medium py-3 px-6 rounded-lg shadow-md hover:bg-primary/90 transition-all duration-300 transform hover:scale-105;}
      .option-card {@apply border rounded-xl p-4 cursor-pointer transition-all duration-200 bg-white hover:shadow-md;}
      .option-card.selected {@apply border-2 border-primary bg-blue-50;}
      .dimension-card {@apply bg-white border rounded-xl p-5 shadow-sm transition-all duration-200 hover:shadow-md;}
      .social-btn {@apply w-full text-white text-sm font-medium py-2 px-4 rounded-lg shadow hover:opacity-90 transition;}
      .chart-container {@apply relative w-full overflow-hidden;}
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen font-sans text-neutral">
  <!-- 社交链接 -->
  <div class="flex flex-col items-center space-y-2 p-4">
    <a href="https://github.com/dachangzhishiku/dachangzhishiku.github.io" target="_blank" class="social-btn bg-blue-500">
      ⭐ 如果觉得还不错，欢迎来 GitHub 点亮星星
    </a>
    <a href="https://www.xiaohongshu.com/user/profile/660ea153000000000600c7ba?xsec_token=YB_QX_iMe6bUxk35Ffx2heGFaOsvVziKC0rCCQ0UViyfQ=&amp;xsec_source=app_share&amp;xhsshare=CopyLink&amp;appuid=660ea153000000000600c7ba&amp;apptime=1755827298&amp;share_id=b371e9936e8c497885ab3be09a0fbcc3" target="_blank" class="social-btn bg-red-500">
      ❤️ 欢迎关注我的小红书，持续更新职场实用干货
    </a>
  </div>

  <!-- 测试页面 -->
  <div id="quiz-page" class="min-h-screen p-4">
    <div class="text-center max-w-md mx-auto mb-6">
      <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent mb-4">嫡系计算器2.0</h1>
      <p class="text-gray-600 text-base md:text-lg">通过9个维度测试，评估你在组织中的嫡系程度</p>
    </div>
    <div class="max-w-2xl mx-auto">
      <div class="mb-6">
        <div class="flex justify-between text-sm text-gray-500 mb-2">
          <span>已完成 <span id="completed-count">0</span>/9 题</span>
          <span id="progress-text">0%</span>
        </div>
        <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
          <div id="progress-bar" class="h-full bg-primary transition-all duration-500 ease-out" style="width:0%"></div>
        </div>
      </div>
      <h2 class="text-xl md:text-2xl font-bold mb-6 text-center">请回答以下所有问题</h2>
      <div id="questions-container" class="space-y-4 mb-8"></div>
      <div class="flex justify-center">
        <button id="submit-btn" class="btn-primary" disabled="">提交答案</button>
      </div>
    </div>
  </div>

  <!-- 结果页面 -->
  <div id="result-page" class="min-h-screen p-4 hidden">
    <div class="max-w-4xl mx-auto space-y-6">
      <!-- 综合得分卡片 -->
      <div class="bg-white rounded-2xl shadow-md p-5 text-center" id="score-card">
        <h2 class="text-xl md:text-2xl font-bold mb-3">综合得分</h2>
        <div id="score-text" class="text-4xl md:text-5xl font-extrabold text-primary mb-3"></div>
        <div id="level-text" class="text-base md:text-lg font-medium text-gray-600 mb-3"></div>
        <div class="text-left text-xs md:text-sm text-gray-500 border-t pt-3 mt-3">
          <h3 class="font-semibold mb-2">嫡系等级判定说明</h3>
          <table class="w-full border-collapse text-xs">
            <tbody><tr class="bg-gray-100">
              <th class="p-2 border">总分范围</th>
              <th class="p-2 border">嫡系等级</th>
              <th class="p-2 border">职场特征</th>
            </tr>
            <tr>
              <td class="p-2 border">&gt;60分</td>
              <td class="p-2 border">心腹嫡系</td>
              <td class="p-2 border">参与重大决策，掌握核心资源，领导心腹</td>
            </tr>
            <tr>
              <td class="p-2 border">50-60分</td>
              <td class="p-2 border">核心圈层</td>
              <td class="p-2 border">负责关键业务，资源优先配置，领导核心圈层</td>
            </tr>
            <tr>
              <td class="p-2 border">40-50分</td>
              <td class="p-2 border">外围人员</td>
              <td class="p-2 border">常规工作关系，无特殊关照</td>
            </tr>
            <tr>
              <td class="p-2 border">&lt;40分</td>
              <td class="p-2 border">风险人员</td>
              <td class="p-2 border">可能被边缘化或优化</td>
            </tr>
          </tbody></table>
        </div>
      </div>

      <!-- 雷达图卡片 -->
      <div class="bg-white rounded-2xl shadow-md p-5" id="radar-card">
        <h3 class="text-lg md:text-xl font-bold mb-3 text-center">维度雷达图</h3>
        <div class="chart-container" style="height: 300px;">
          <canvas id="radarChart"></canvas>
        </div>
      </div>

      <!-- 维度详情 -->
      <div class="bg-white rounded-2xl shadow-md p-5">
        <h3 class="text-lg md:text-xl font-bold mb-4 text-center">维度详情</h3>
        <div id="dimensions-container" class="grid grid-cols-1 gap-3">
          <!-- 维度卡片将在这里动态生成 -->
        </div>
      </div>

      <!-- 操作按钮 -->
      <div class="text-center flex flex-col sm:flex-row justify-center gap-3">
        <button id="share-btn" class="btn-primary"><i class="fa fa-share mr-2"></i>生成分享图</button>
        <button id="share-calculator-btn" class="btn-primary bg-green-600 hover:bg-green-700"><i class="fa fa-link mr-2"></i>分享计算器</button>
        <button id="back-btn" class="btn-primary bg-gray-600 hover:bg-gray-700"><i class="fa fa-arrow-left mr-2"></i>返回上一页</button>
      </div>
    </div>
  </div>

  <!-- 群聊信息 -->
  <div class="max-w-2xl mx-auto text-center mt-6 p-4">
    <p class="text-gray-700 text-sm mb-3">建了个群聊，致力于突破大厂信息茧房，每周掉落职场干货，欢迎进群~</p>
    <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/812d77df9eef40959316a03291598db6~tplv-a9rns2rl98-image.image?rcl=20250822102816B11F6EB0A81697AF4CE8&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1756434500&amp;x-signature=XJNHe4hCyWNGfeJP4OJTsvJNxyc%3D" alt="微信群二维码" class="mx-auto w-40 h-40 rounded-lg shadow">
  </div>

  <script>
    // 问题数据
    const questions = [
      { 
        text: "组织关系", 
        dimension: "组织关系", 
        options: [
          {text:"跨三级汇报", score:20, analysis: "层级距离远，信息传递衰减。", suggestion: "主动建立跨级沟通渠道。"},
          {text:"跨两级汇报", score:40, analysis: "存在层级隔阂，影响力有限。", suggestion: "争取更多向上展示的机会。"},
          {text:"直接汇报", score:60, analysis: "常规汇报关系，沟通顺畅。", suggestion: "提升汇报质量，建立信任。"},
          {text:"直接汇报+同部门≥3年", score:80, analysis: "长期合作，有一定信任基础。", suggestion: "深化业务绑定，成为可靠助手。"},
          {text:"领导前嫡系团队", score:100, analysis: "深度绑定，高度信任。", suggestion: "维护长期信任，成为左膀右臂。"}
        ]
      },
      { 
        text: "信任等级", 
        dimension: "信任等级", 
        options: [
          {text:"仅工作沟通", score:20, analysis: "纯工作关系，无额外信任。", suggestion: "增加工作外互动，建立好感。"},
          {text:"参与常规会议", score:40, analysis: "基础信任，纳入常规信息圈。", suggestion: "会议中积极贡献，展现价值。"},
          {text:"参加领导小范围会议", score:60, analysis: "中度信任，进入核心信息圈。", suggestion: "保守机密，提升判断力。"},
          {text:"处理领导私人事务", score:80, analysis: "高度信任，超越工作关系。", suggestion: "把握分寸，公私分明。"},
          {text:"掌握领导核心资源", score:100, analysis: "绝对信任，成为核心心腹。", suggestion: "忠诚可靠，保守核心秘密。"}
        ]
      },
      { 
        text: "项目权重", 
        dimension: "项目权重", 
        options: [
          {text:"支持性工作", score:20, analysis: "参与度低，影响力有限。", suggestion: "主动承担更多责任，展现能力。"},
          {text:"独立模块负责人", score:40, analysis: "有一定职责，但非核心。", suggestion: "做出亮点，争取更大范围负责。"},
          {text:"核心项目骨干", score:60, analysis: "承担重要工作，受重视。", suggestion: "打造核心竞争力，成为不可或缺的角色。"},
          {text:"战略项目负责人", score:80, analysis: "负责关键项目，有战略价值。", suggestion: "确保项目成功，提升战略影响力。"},
          {text:"领导亲自指派项目", score:100, analysis: "深度信任，承担特殊使命。", suggestion: "超额完成，巩固信任基础。"}
        ]
      },
      { 
        text: "晋升轨迹", 
        dimension: "晋升轨迹", 
        options: [
          {text:"无晋升", score:0, analysis: "发展停滞，需警惕。", suggestion: "寻找问题根源，主动寻求突破。"},
          {text:"正常晋升", score:20, analysis: "按部就班，符合预期。", suggestion: "提升差异化优势，争取加速发展。"},
          {text:"破格晋升", score:40, analysis: "表现突出，获得认可。", suggestion: "保持势头，证明晋升合理性。"},
          {text:"跟随领导调岗晋升", score:80, analysis: "受领导器重，同步发展。", suggestion: "适应新环境，快速创造价值。"},
          {text:"领导特批职级", score:100, analysis: "高度认可，特殊对待。", suggestion: "匹配职级要求，不负所托。"}
        ]
      },
      { 
        text: "资源倾斜", 
        dimension: "资源倾斜", 
        options: [
          {text:"资源受限", score:25, analysis: "获取资源较少。", suggestion: "学会用有限资源做出成果。"},
          {text:"标准配置", score:50, analysis: "处于正常水平。", suggestion: "逐渐申请更多资源。"},
          {text:"优先获取资源", score:75, analysis: "具备较高优先级。", suggestion: "确保成果回报资源支持。"},
          {text:"领导特批资源", score:100, analysis: "获得特殊照顾。", suggestion: "谨慎使用，避免口碑风险。"}
        ]
      },
      { 
        text: "信息权限", 
        dimension: "信息权限", 
        options: [
          {text:"信息滞后", score:25, analysis: "处于信息末端。", suggestion: "主动拓展信息渠道。"},
          {text:"同步知悉", score:50, analysis: "获取信息及时。", suggestion: "保证理解和执行。"},
          {text:"提前获知未公开信息", score:75, analysis: "提前获知，说明被信任。", suggestion: "注意保密。"},
          {text:"参与决策讨论", score:100, analysis: "直接参与核心决策。", suggestion: "发挥战略思考力。"}
        ]
      },
      { 
        text: "危机处理", 
        dimension: "危机处理", 
        options: [
          {text:"被牺牲", score:25, analysis: "处于弱势，风险高。", suggestion: "增强不可替代性。"},
          {text:"中立状态", score:50, analysis: "保持中性，安全但边缘。", suggestion: "寻找提升存在感的机会。"},
          {text:"领导公开维护", score:75, analysis: "获得一定保护。", suggestion: "维持与领导良好关系。"},
          {text:"领导私下保护", score:100, analysis: "深度信任，关键时刻被优先照顾。", suggestion: "继续巩固，保持低调。"}
        ]
      },
      { 
        text: "绩效情况", 
        dimension: "绩效情况", 
        options: [
          {text:"长期低绩效/背锅侠（C/D）", score:20, analysis: "处于边缘或风险。", suggestion: "寻找短期可提升的突破口。"},
          {text:"近期绩效下滑（S/A→B/C）", score:40, analysis: "状态不稳定。", suggestion: "分析原因并快速调整。"},
          {text:"稳定中等（近2次B+/B）", score:60, analysis: "处于稳定区间。", suggestion: "适当寻找亮点项目突破。"},
          {text:"近期绩效提升（近2次B+/B）", score:80, analysis: "状态上升。", suggestion: "持续保持，扩大影响力。"},
          {text:"持续高绩效（近2次S/A）", score:100, analysis: "核心绩效背书。", suggestion: "保持长期稳定，关注团队贡献。"}
        ]
      },
      { 
        text: "RSU/股权激励授予", 
        dimension: "股权激励", 
        options: [
          {text:"从未获得过任何激励", score:20, analysis: "不在激励核心。", suggestion: "提升稀缺价值，争取关注。"},
          {text:"仅入职授予，后续无新增", score:40, analysis: "缺乏持续性认可。", suggestion: "保持业绩，争取新激励。"},
          {text:"授予价值低于同级", score:60, analysis: "认可度有限。", suggestion: "对比同级，提出合理诉求。"},
          {text:"授予价值高于同级", score:80, analysis: "价值较高。", suggestion: "继续提升，保持核心地位。"},
          {text:"授予周期稳定且价值可观", score:100, analysis: "处于激励核心。", suggestion: "稳定发挥，避免波动。"}
        ]
      }
    ];

    // 渲染问题
    function renderAllQuestions() {
      const container = document.getElementById('questions-container');
      container.innerHTML = '';
      questions.forEach((q, index) => {
        const card = document.createElement('div');
        card.className = 'bg-white rounded-xl shadow-md p-4';
        let opts = '';
        q.options.forEach((opt, i) => {
          opts += `<div class=\"option-card\" data-q=\"${index}\" data-option-index=\"${i}\" data-score=\"${opt.score}\">${opt.text}</div>`;
        });
        card.innerHTML = `<h3 class='text-lg font-semibold mb-3'>${index+1}. ${q.text}</h3><div class='space-y-2'>${opts}</div>`;
        container.appendChild(card);
      });
    }

    // 更新进度
    function updateProgress() {
      const total = questions.length;
      const answered = document.querySelectorAll('.option-card.selected').length;
      document.getElementById('completed-count').innerText = answered;
      const percent = Math.round((answered/total)*100);
      document.getElementById('progress-text').innerText = percent+"%";
      document.getElementById('progress-bar').style.width = percent+"%";
      document.getElementById('submit-btn').disabled = answered < total;
    }

    // 计算结果
    function calculateResult() {
      let results = [];
      let sum = 0;
      let count = 0;
      
      questions.forEach((q,i) => {
        const sel = document.querySelector(`.option-card.selected[data-q='${i}']`);
        if(sel){
          const optionIndex = parseInt(sel.dataset.optionIndex);
          const selectedOption = q.options[optionIndex];
          results.push({
            dimension: q.dimension,
            score: selectedOption.score,
            analysis: selectedOption.analysis,
            suggestion: selectedOption.suggestion
          });
          sum += selectedOption.score;
          count++;
        }
      });
      
      const avg = count > 0 ? (sum / count) : 0;
      showResult(results, avg);
    }

    // 获取等级文本
    function getLevelText(score) {
      if(score > 60) return "心腹嫡系：参与重大决策，掌握核心资源，领导心腹";
      if(score >= 50) return "核心圈层：负责关键业务，资源优先配置，领导核心圈层";
      if(score >= 40) return "外围人员：常规工作关系，无特殊关照";
      return "风险人员：可能被边缘化或优化";
    }

    // 显示结果
    function showResult(dimensions, avg){
      document.getElementById('quiz-page').classList.add('hidden');
      const res = document.getElementById('result-page');
      res.classList.remove('hidden');
      
      // 更新综合得分
      document.getElementById('score-text').innerText = avg.toFixed(1);
      document.getElementById('level-text').innerText = getLevelText(avg);

      // 绘制雷达图（优化移动设备显示）
      const ctx = document.getElementById('radarChart');
      
      // 销毁已存在的图表，避免重复绘制
      if (window.radarChartInstance) {
        window.radarChartInstance.destroy();
      }
      
      // 检测屏幕宽度，调整图表配置
      const isMobile = window.innerWidth < 640;
      
      window.radarChartInstance = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: dimensions.map(d => d.dimension),
          datasets: [{
            label: '得分',
            data: dimensions.map(d => d.score),
            backgroundColor: 'rgba(59,130,246,0.2)',
            borderColor: '#3b82f6',
            pointBackgroundColor: '#3b82f6',
            pointRadius: isMobile ? 3 : 5,
            pointHoverRadius: isMobile ? 5 : 7
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            r: {
              beginAtZero: true,
              max: 100,
              ticks: {
                display: !isMobile, // 移动端不显示刻度值
                stepSize: 20
              },
              pointLabels: {
                font: {
                  size: isMobile ? 10 : 12 // 移动端缩小标签字体
                },
                padding: isMobile ? 5 : 10
              }
            }
          },
          plugins: {
            legend: {
              display: !isMobile // 移动端不显示图例
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `${context.label}: ${context.raw}分`;
                }
              }
            }
          }
        }
      });

      // 生成维度详情卡片（优化移动设备显示）
      const container = document.getElementById('dimensions-container');
      container.innerHTML = '';
      
      // 根据屏幕宽度设置网格布局
      if (window.innerWidth >= 768) {
        container.classList.add('md:grid-cols-2');
      }
      if (window.innerWidth >= 1024) {
        container.classList.add('lg:grid-cols-3');
      }
      
      dimensions.forEach(dimension => {
        const card = document.createElement('div');
        card.className = 'dimension-card';
        card.innerHTML = `
          <div class="font-semibold text-primary mb-2">${dimension.dimension}：${dimension.score}分</div>
          <div class="text-sm text-gray-600 mb-3">现状分析：${dimension.analysis}</div>
          <div class="text-sm bg-blue-50 p-3 rounded-lg">行动建议：${dimension.suggestion}</div>
        `;
        container.appendChild(card);
      });
    }

    // 事件监听
    document.addEventListener('click', e => {
      if(e.target.classList.contains('option-card')){
        const qid = e.target.dataset.q;
        document.querySelectorAll(`.option-card[data-q='${qid}']`).forEach(el => {
          el.classList.remove('selected');
        });
        e.target.classList.add('selected');
        updateProgress();
      }
    });

    document.getElementById('submit-btn').addEventListener('click', calculateResult);
    
    // 返回按钮事件
    document.getElementById('back-btn').addEventListener('click', () => {
      document.getElementById('result-page').classList.add('hidden');
      document.getElementById('quiz-page').classList.remove('hidden');
    });

// 修改生成分享图按钮事件
document.getElementById('share-btn').addEventListener('click', async function() {
  const btn = this;
  // 保存原始按钮文本，用于恢复
  const originalBtnText = btn.innerHTML;
  
  // 防止重复点击，设置加载状态
  btn.disabled = true;
  btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> 生成中...';
  
  try {
    console.log('生成分享图按钮被点击');
    // 使用 Toast 替代 alert 提升体验（假设存在简易 toast 实现）
    showToast('开始生成分享图...', 'info');
    
    if (typeof html2canvas === 'undefined') {
      throw new Error('截图工具未加载，请刷新页面重试');
    }
    
    // 获取需要截图的两个卡片元素
    const scoreCard = document.getElementById('score-card');
    const radarCard = document.getElementById('radar-card');
    
    if (!scoreCard || !radarCard) {
      throw new Error('未找到需要截图的内容');
    }
    
    // 创建一个临时容器来组合两个卡片
    const tempContainer = document.createElement('div');
    // 使用内联样式确保布局正确
    Object.assign(tempContainer.style, {
      display: 'flex',
      flexDirection: 'column',
      gap: '16px',
      padding: '16px',
      backgroundColor: '#fff',
      position: 'absolute',
      top: '-9999px',
      left: '-9999px',
      // 确保容器尺寸正确
      width: `${Math.max(scoreCard.offsetWidth, radarCard.offsetWidth)}px`
    });
    
    // 克隆卡片并添加到临时容器（深克隆确保样式和内容完整）
    const scoreCardClone = scoreCard.cloneNode(true);
    const radarCardClone = radarCard.cloneNode(true);
    tempContainer.appendChild(scoreCardClone);
    tempContainer.appendChild(radarCardClone);
    
    // 将临时容器添加到文档中
    document.body.appendChild(tempContainer);
    
    // 给浏览器一点时间渲染克隆元素
    await new Promise(resolve => setTimeout(resolve, 100));
    
    // 截取临时容器内容
    console.log('开始截取综合得分和雷达图...');
    const contentCanvas = await html2canvas(tempContainer, {
      useCORS: true,
      scale: window.devicePixelRatio || 1.5, // 基于设备像素比优化清晰度
      allowTaint: false,
      logging: false,
      backgroundColor: null // 确保背景透明部分正确处理
    });
    
    // 移除临时容器
    document.body.removeChild(tempContainer);

    // 创建最终的分享图 canvas ，并绘制内容 + 二维码
    const finalCanvas = document.createElement('canvas');
    const ctx = finalCanvas.getContext('2d');
    // 内容 canvas 宽高
    const contentWidth = contentCanvas.width;
    const contentHeight = contentCanvas.height;
    // 二维码尺寸（根据内容宽度自适应）
    const qrCodeSize = Math.min(150, contentWidth * 0.3); 
    // 最终 canvas 高度 = 内容高度 + 二维码高度 + 间距 + 文字高度
    finalCanvas.width = contentWidth;
    finalCanvas.height = contentHeight + qrCodeSize + 50; 

    // 优化绘制质量
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = 'high';

    // 绘制内容到最终 canvas
    ctx.drawImage(contentCanvas, 0, 0);

    // 加载并绘制二维码
    await new Promise((resolve, reject) => {
      const qrCodeImage = new Image();
      qrCodeImage.src = 'https://s21.ax1x.com/2025/08/22/pVDydr4.png';
      qrCodeImage.crossOrigin = 'anonymous'; // 解决跨域问题
      
      qrCodeImage.onload = function() {
        // 计算二维码位置，底部居中
        const qrX = (contentWidth - qrCodeSize) / 2;
        const qrY = contentHeight + 15; 
        ctx.drawImage(qrCodeImage, qrX, qrY, qrCodeSize, qrCodeSize);

        // 添加二维码说明文字
        ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
        ctx.fillStyle = '#333';
        ctx.textAlign = 'center';
        ctx.fillText('扫码查看详情', contentWidth / 2, contentHeight + qrCodeSize + 35);

        resolve();
      };
      
      qrCodeImage.onerror = function() {
        reject(new Error('二维码图片加载失败'));
      };
    });

    // 下载最终的分享图
    const link = document.createElement('a');
    link.download = '嫡系计算器结果.png';
    // 优化图片质量
    link.href = finalCanvas.toDataURL('image/png', 0.95);
    document.body.appendChild(link);
    link.click();
    // 延迟移除避免某些浏览器下载失败
    setTimeout(() => document.body.removeChild(link), 100);
    
    showToast('分享图已生成并下载！', 'success');
    console.log('截图 + 二维码绘制成功');
    
  } catch (error) {
    console.error('生成分享图失败:', error);
    // 显示具体错误信息
    showToast(`生成失败: ${error.message}`, 'error');
    
    // 如果是二维码错误，尝试下载不含二维码的版本
    if (error.message.includes('二维码') && typeof contentCanvas !== 'undefined') {
      const link = document.createElement('a');
      link.download = '嫡系计算器结果.png';
      link.href = contentCanvas.toDataURL('image/png');
      document.body.appendChild(link);
      link.click();
      setTimeout(() => document.body.removeChild(link), 100);
    }
  } finally {
    // 恢复按钮状态
    btn.disabled = false;
    btn.innerHTML = originalBtnText;
  }
});

// 简易 Toast 实现（可根据实际项目替换）
function showToast(message, type = 'info') {
  // 避免重复创建多个 toast
  const existingToast = document.querySelector('.custom-toast');
  if (existingToast) {
    existingToast.remove();
  }
  
  const toast = document.createElement('div');
  toast.className = `custom-toast fixed bottom-4 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-md text-white z-50 transition-all duration-300 ${
    type === 'success' ? 'bg-green-500' : 
    type === 'error' ? 'bg-red-500' : 'bg-blue-500'
  }`;
  toast.textContent = message;
  document.body.appendChild(toast);
  
  // 3秒后自动消失
  setTimeout(() => {
    toast.style.opacity = '0';
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}


    // 分享计算器按钮事件
    document.getElementById('share-calculator-btn').addEventListener('click', async () => {
      const url = 'https://dachangzhishiku.github.io/';
      try {
        await navigator.clipboard.writeText(url);
        alert('网址已复制，快去粘贴吧');
      } catch (err) {
        console.error('无法复制文本: ', err);
        alert('复制失败，请手动复制: ' + url);
      }
    });

    // 页面加载完成后初始化
    window.onload = function() {
      renderAllQuestions();
      
      // 监听窗口大小变化，重新绘制图表
      window.addEventListener('resize', function() {
        const resultPage = document.getElementById('result-page');
        if (!resultPage.classList.contains('hidden')) {
          // 如果在结果页面，重新计算并显示结果以更新布局
          calculateResult();
        }
      });
    };
  </script>
</body></html>
